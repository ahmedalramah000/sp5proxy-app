<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SP5Proxy Desktop</title>
    
    <!-- Content Security Policy for Electron security -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';" />
    
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: #1e1e1e;
        color: white;
        overflow: auto;
      }

      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      }

      body.app-ready #loading-screen {
        opacity: 0;
        visibility: hidden;
      }

      #react-root {
        width: 100%;
        min-height: 100vh;
        opacity: 0;
        transition: opacity 0.5s ease-in;
        overflow-y: auto;
      }

      body.app-ready #react-root {
        opacity: 1;
      }

      .loading-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(45deg, #007acc, #0099ff);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 2rem;
        animation: pulse 2s ease-in-out infinite;
      }

      .loading-icon::before {
        content: "üîí";
        font-size: 2rem;
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #333;
        border-top: 3px solid #007acc;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-top: 1rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
      <div class="loading-icon"></div>
      <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">SP5Proxy Desktop</div>
      <div style="font-size: 1rem; color: #cccccc; margin-bottom: 2rem;">Initializing secure proxy connection...</div>
      <div class="loading-spinner"></div>
    </div>

    <!-- React Application Container -->
    <div id="react-root"></div>

    <script>
      console.log('üåê HTML loaded, starting React bundle...');
      console.log('üîç DOM ready state:', document.readyState);
      console.log('üîç Window location:', window.location.href);

      // Polyfill for global variable (Electron renderer process compatibility)
      if (typeof global === 'undefined') {
        window.global = window;
        console.log('‚úÖ Global polyfill applied');
      }

      // Add error handling for script loading
      window.addEventListener('error', function(e) {
        console.error('‚ùå Script loading error:', e.filename, e.lineno, e.message);
        if (e.filename && e.filename.includes('bundle')) {
          console.error('‚ùå React bundle failed to load - showing fallback interface');
          setTimeout(() => {
            if (!document.body.classList.contains('app-ready')) {
              window.showFallbackInterface();
            }
          }, 2000);
        }
      });

      // Function to hide loading screen when React is ready
      window.hideLoadingScreen = function() {
        console.log('üéØ React app is ready, hiding loading screen...');
        console.log('üîç Current body classes before:', document.body.className);
        
        document.body.classList.add('app-ready');
        
        console.log('üîç Current body classes after:', document.body.className);
        console.log('üîç Loading screen element:', document.getElementById('loading-screen'));
        
        // Also notify the main process that React is ready
        if (window.electronAPI && window.electronAPI.notifyReactReady) {
          console.log('üîó Notifying main process that React is ready...');
          window.electronAPI.notifyReactReady();
        } else {
          console.log('‚ö†Ô∏è electronAPI not available for notification');
        }
      };

      // Fallback interface function
      window.showFallbackInterface = function() {
        console.log('üîß Showing fallback interface...');
        document.body.classList.add('app-ready');
        
        const reactRoot = document.getElementById('react-root');
        if (reactRoot && reactRoot.innerHTML.trim() === '') {
          reactRoot.innerHTML = `
            <div style="padding: 20px; font-family: Arial, sans-serif; color: white; background: #1e1e1e; min-height: 100vh;">
              <h1 style="color: #007acc; margin-bottom: 20px;">üîó SP5Proxy Desktop</h1>
              <div style="background: #2d2d2d; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h2 style="color: #ffffff; margin-bottom: 15px;">Proxy Connection</h2>
                <div style="margin-bottom: 10px;">
                  <label style="display: block; margin-bottom: 5px; color: #cccccc;">Server:</label>
                  <input type="text" value="68.225.23.92:18240" style="width: 300px; padding: 8px; border: 1px solid #555; background: #333; color: white; border-radius: 4px;" readonly>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; color: #cccccc;">Type:</label>
                  <select style="width: 150px; padding: 8px; border: 1px solid #555; background: #333; color: white; border-radius: 4px;">
                    <option>SOCKS5</option>
                    <option>HTTP</option>
                  </select>
                </div>
                <button onclick="alert('Proxy connection functionality is available via the backend API on port 3002')" 
                        style="background: #007acc; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                  Connect to Proxy
                </button>
                <button onclick="alert('Proxy disconnection functionality is available via the backend API on port 3002')" 
                        style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; margin-left: 10px;">
                  Disconnect
                </button>
              </div>
              <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="color: #ffffff; margin-bottom: 10px;">Status</h3>
                <p style="color: #28a745; margin: 0;">‚úÖ Backend services running on port 3002</p>
                <p style="color: #28a745; margin: 5px 0 0 0;">‚úÖ Proxy configuration loaded</p>
              </div>
              <div style="background: #2d2d2d; padding: 15px; border-radius: 8px;">
                <h3 style="color: #ffffff; margin-bottom: 10px;">Quick Actions</h3>
                <button onclick="window.location.reload()" 
                        style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                  Reload Interface
                </button>
              </div>
            </div>
          `;
          console.log('üì± Fallback interface loaded');
        }
        
        if (window.electronAPI && window.electronAPI.notifyReactReady) {
          window.electronAPI.notifyReactReady();
        }
      };

      // Auto-hide loading screen after 5 seconds as fallback
      setTimeout(() => {
        if (!document.body.classList.contains('app-ready')) {
          console.log('‚è∞ Auto-hiding loading screen after timeout...');
          window.showFallbackInterface();
        }
      }, 5000);
      
      // Add debugging for DOM ready
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ DOM Content Loaded event fired');
      });
      
      // Add debugging for window load
      window.addEventListener('load', function() {
        console.log('üåê Window load event fired');
      });
    </script>

    <!-- HtmlWebpackPlugin will automatically inject bundle scripts here -->
</body>
</html>
